<div class="display-videos-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="header-icon">live_tv</mat-icon>
        <div>
          <h1>Videos de Display</h1>
          <p class="subtitle">Gestiona los videos que se muestran en las pantallas de TV</p>
        </div>
      </div>
      <div class="stats-chips">
        <span class="stat-chip">
          <mat-icon>video_library</mat-icon>
          {{ totalVideos }} videos
        </span>
        <span class="stat-chip active">
          <mat-icon>play_circle</mat-icon>
          {{ activeVideos }} activos
        </span>
      </div>
    </div>
  </div>

  <!-- Add Video Card -->
  <mat-card class="add-video-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>add_circle</mat-icon>
        Agregar Video
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="add-form">
        <mat-form-field appearance="outline" class="video-id-field">
          <mat-label>ID de YouTube</mat-label>
          <input matInput [(ngModel)]="newVideoId" placeholder="Ej: dQw4w9WgXcQ">
          <mat-hint>El ID se encuentra en la URL del video: youtube.com/watch?v=<strong>ID_AQUÍ</strong></mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="title-field">
          <mat-label>Título (opcional)</mat-label>
          <input matInput [(ngModel)]="newTitle" placeholder="Descripción del video">
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="addVideo()" [disabled]="loading || !newVideoId.trim()">
          <mat-icon>add</mat-icon>
          Agregar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Videos Table -->
  <mat-card class="videos-table-card">
    <mat-card-content>
      <div class="loading-overlay" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <table mat-table [dataSource]="dataSource" class="videos-table" *ngIf="!loading">
        <!-- Order Column -->
        <ng-container matColumnDef="DisplayOrder">
          <th mat-header-cell *matHeaderCellDef>Orden</th>
          <td mat-cell *matCellDef="let video">
            <div class="order-controls">
              <button mat-icon-button (click)="moveUp(video)" [disabled]="video.DisplayOrder === 0" matTooltip="Subir">
                <mat-icon>arrow_upward</mat-icon>
              </button>
              <span class="order-number">{{ video.DisplayOrder + 1 }}</span>
              <button mat-icon-button (click)="moveDown(video)" matTooltip="Bajar">
                <mat-icon>arrow_downward</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- VideoId Column -->
        <ng-container matColumnDef="VideoId">
          <th mat-header-cell *matHeaderCellDef>ID YouTube</th>
          <td mat-cell *matCellDef="let video">
            <a [href]="getYoutubeUrl(video.VideoId)" target="_blank" class="video-id-link">
              {{ video.VideoId }}
              <mat-icon class="external-icon">open_in_new</mat-icon>
            </a>
          </td>
        </ng-container>

        <!-- Title Column -->
        <ng-container matColumnDef="Title">
          <th mat-header-cell *matHeaderCellDef>Título</th>
          <td mat-cell *matCellDef="let video">
            {{ video.Title || '(Sin título)' }}
          </td>
        </ng-container>

        <!-- Preview Column -->
        <ng-container matColumnDef="Preview">
          <th mat-header-cell *matHeaderCellDef>Vista Previa</th>
          <td mat-cell *matCellDef="let video">
            <img [src]="getYoutubeThumbnail(video.VideoId)"
                 [alt]="video.Title || video.VideoId"
                 class="video-thumbnail"
                 loading="lazy">
          </td>
        </ng-container>

        <!-- IsActive Column -->
        <ng-container matColumnDef="IsActive">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let video">
            <mat-slide-toggle
              [checked]="video.IsActive"
              (change)="toggleActive(video)"
              color="primary">
              {{ video.IsActive ? 'Activo' : 'Inactivo' }}
            </mat-slide-toggle>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="Actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let video">
            <button mat-icon-button color="warn" (click)="deleteVideo(video)" matTooltip="Eliminar">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            [class.inactive-row]="!row.IsActive"></tr>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!loading && dataSource.data.length === 0">
        <mat-icon>video_library</mat-icon>
        <h3>No hay videos configurados</h3>
        <p>Agrega videos de YouTube para mostrar en las pantallas de display</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Info Card -->
  <mat-card class="info-card">
    <mat-card-content>
      <mat-icon>info</mat-icon>
      <div class="info-text">
        <strong>Pantallas de Display:</strong>
        Los videos configurados se mostrarán automáticamente en las pantallas de TV
        (<code>/tv01.html</code>, <code>/tv02.html</code>).
        Los videos activos se reproducen en orden de forma continua.
      </div>
    </mat-card-content>
  </mat-card>
</div>
